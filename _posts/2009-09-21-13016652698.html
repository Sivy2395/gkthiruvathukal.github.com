---
layout: post
title: MacPorts on Snow Leopard without changing your current drive's filesystem.
---

<p>I had been experiencing a LOT of trouble with MacPorts on OS X after upgrading to Snow Leopard. As it turns out, I apparently was bitten by the perennial case-insensitive filesystem, which of course is the default option when one installs OS X (or has it installed for them via Apple).<br/><br/>So I followed the instructions on <a href="http://laufer.cs.luc.edu/2009/09/prerequisites-for-building-openwrt-sdk.html">Konstantin Läufer’s Blog: Prerequisites for Building OpenWRT SDK on Snow Leopard</a> with a slight amendment, given that I was completely unwilling to change the host filesystem for no particularly compelling reason. (Yes, I am a Unix guy, but I really don’t care about case-sensitivity when I am <span style="font-style: italic;">not</span> doing programming.)<br/><br/>Enter disk images, which is perhaps one of the best OS X features that is taken for granted and can be a true life saver at times. With an disk image, you can create a filesystem that differs from the host as an read-write image, mount it, and use it from the OS or any application—seamlessly. So here are the steps to get /opt/local to live inside a case-sensitive filesystem but be exposed through the host filesystem (so that MacPorts can be maintained properly):<br/><br/></p><ol><li>Launch Disk Utility (Applications -&gt; Utilities -&gt; Disk Utility)</li><li>At your discretion, create either a regular read/write image or sparseimage. Sparse images are the preferred option, especially if you want room for growth. Make sure you enable the case-sensitive option, which is needed for MacPorts (at this time). </li><li>I suggest putting the image somewhere intelligent like your home directory -&gt; Disk Images (create a folder). You may also want to turn off backups of this directory in Time Machine, if you are updating MacPorts frequently. It is easy to put an entire folder under an exclusion list in Time Machine.</li><li>When you created the disk image in step 2, you likely gave it a name. I named my image MacPorts. Upon creation, the image should mount automatically and will stay mounted until you unmount it. In my case, I see the following when I go into Terminal:<br/><br/>/dev/disk3s2 on /Volumes/MacPorts (hfs, local, nodev, nosuid, journaled, noowners, mounted by gkt)<br/><br/></li><li>So by way of example, I did the following. You may opt to do something different, depending on your needs:<br/><br/>mkdir -p /Volumes/MacPorts/opt/local<br/>Make sure /opt does not exist. (I will let you decide how to do this!)<br/>ln -s /Volumes/MacPorts/opt /opt<br/><br/></li><li>At this point /opt/local is living on your disk image. You may now proceed with the MacPorts installation on Snow Leopard.</li></ol><div>Update: One thing I discovered after making this posting, of course, is that there is seemingly no “nice” way to make disk images mount at boot time. I still haven’t figured this out. However, I have discovered that for the most common use (i.e. when I am logged in on my desktop), I just need to make sure there is a proper script that runs at boot time to ensure the MacPorts volume is mounted.</div><div><br/></div><div>So to get this working, you just need a tiny bit of AppleScript code. You can actually record the actions using the AppleScript Editor in OS X. Then you end up with a script that looks like this:</div><div><br/></div><div><div>tell application “Finder”</div><div><span class="Apple-tab-span" style="white-space: pre;"> </span>activate</div><div><span class="Apple-tab-span" style="white-space: pre;"> </span>set target of Finder window 1 to folder “gkt” of folder “Users” of startup disk</div><div><span class="Apple-tab-span" style="white-space: pre;"> </span>open document file “MacPorts.sparseimage” of folder “Disk Images” of folder “gkt” of folder “Users” of startup disk</div><div><span class="Apple-tab-span" style="white-space: pre;"> </span>close Finder window 1</div><div>end tell</div><div><br/></div><div>Pretty slick. Then all you need to do is compile it into an Application (a .app) bundle. Drag the bundle to the “dock” and right click, Open at Login. That’s it. You’ll have the bundle mounted when you log in to your desktop and be available immediately.</div></div><div class="blogger-post-footer"><img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/4909373900263798053-8239023617162923752?l=gkthiruvathukal.blogspot.com" alt=""/></div>
